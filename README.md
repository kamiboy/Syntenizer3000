# Syntenizer3000
Tool for bacterial genome analysis including but not limited to synteny measurement.

Run build.sh in the folder with the source code to build an executable on a UNIX derived OS. GCC with at least C++11 support or equivalent must be installed.

Run without any input parameters to get a list of possible arguments and a short explanation of what they do.

Below is an example of running the program with a full suite of analysis enabled:

./Syntenizer --gffdir=/data/input --outdir=/data/output --genegroups=/data/input/gene_groups.csv --contigcolours=/data/input/ContigColours.csv --syntenizegroups --generatestraincharts --generatesyntenycharts --chromosomeidentifier=chromosome --plasmididentifier=Rh --fragmentidentifier=fragment --genegrouphighlightcolours=/data/input/GeneGroupHighlightColours.csv --ffndir=/data/input --generatefnagroups --presenceabsencematrix --gapitpresenceabsencematrix --generelationmatrix --classifyfragments --disambiguategroups

In the above example all input files, including *.gff, *.fnn gene groups and others are located in the folder '/data/input', and all files generated by the tool are output into the folder '/data/output'.

If the program has been configured to output circular strain chart data or gene group synteny map data then the next step is to render these using the provided R scripts 'GenerateCharts.R' and 'GenerateSyntenyMaps.R'. These scripts need to be rung with a single input parameter, which is the path to the folder with the chart or map data which in the above example would be '/data/output'.

Things to note:

If issues or uncertainties crop up while trying to use the program you can refer to the example dataset provided. A full suit of analysis can be performed using said dataset so it should serve as a guide on how input data should be formatted for the program to work.

Only GFF3 files generated by PROKKA have been tested. Other versions or files generated by other tools may contain variations that might cause incompatibility issues. In that case contact the author for possible solutions or fixes.

Two gene group file formats are supported. The direct gene group file output from ProteinOrtho, plus an internal format detailed below.
Each gene group in the internal format is defined on a ';' separated line starting with The group id as the first item. All subsequent items should be a contatanation of the strain id and gene id with the character '|' separating them. See gene_groups.csv in the example dataset for an example.

To generate basic circular charts the program only needs properly formatted GFF3 files and accompanying gene group file.
However, the GC3s lane requires the presence of gene sequence data. If these are part of the GFF3 files then they will be parsed automatically. Alternatively they can be provided using gene group *.fna files.

In order for contigs to be coloured according to their type (chromosome/plasmid/fragment) then the contig id's in the GFF3 files have to contain an string patter that identifies them as such. The program can then be configured to recognize these 

OPTIONS

--gffdir=dir
Sets the directory where strain gff files are located. All files with the .gff extension will be loaded. The strain ID is           set to the name of the file (with the the extension removed) i.e. the file calb.gff defines the genome of the calb strain.    If contig size and contig sequence data are present in the gff file then these will be parsed. If they are not present the size of each contig is set to the end of the final coding sequence gene defined on said contig. Alternatively sequence data for each gene can be provided using .ffn files. Consult the demo dataset for examples of file formatting. The function of a gene defined using the 'product=' tag will be parsed if it is present. Consult the demo dataset as for examples.
    
--outdir=dir
Sets the output directory for all files generated by Syntenizer3000. This directory must exist beforehand, and any files already present with similar name and extension as output files will be overwritten.

--genegroups=file
Set the file specifying gene groups. Syntenizer3000 can parse two different ways of encoding this information. The first is the direct output file format from the orthology tool ProteinOrtho. The second is an internal format, i.e. as below:
Group1:	strain1|gene1	strain2|gene1
Each tab delimited line starts with a group ID finished with a colon. Then a list of genes 
in said group each consisting of the ID of the gene strain and ID of the gene in said strain, separated by the | ASCII character (0xC7).

--ffndir=dir
Sets the directory where gene sequence .ffn files are located. All files with the ffn extension are parsed, and the gene sequences found within are attached to their corresponding genes. Sequences for unknown genes are ignored. Sequences that may already have been parsed from .gff will be compared to the ones parsed from .ffn files and result in an error if not an exact match.

--contigcolours=file
Sets the file specifying the contig colours in strain charts. Consult the file colours.csv from the demo dataset for an example of how the files is to be formatted. The first tab delimited line is a header defining the role of each subsequent tab delimited line. Each line contains two items, the first is a string pattern, and the second is a valid R colour i.e red, blue, #C0C0C0 etc. The ID of each contig being rendered is searched for the defined string patterns and if there is a match the colour associated with the pattern will be applied to the contig. If the contig ID matches several of the defined string patterns then the colour of the string pattern nearest the end of the contig colour file will be the one used.

--syntenizegroups
Generate synteny score for each gene group into the file groups_synteny.csv, in addition to other useful information about said gene group. Below is an explanation of each column in the ; delimited file:
Group - ID of the group	
Connectivity - The connectivity of the group as parsed from the ProteinOrtho file.
Genes - The number of genes in group.
Strains - The number of unique strains of the genes in group.
Orthologs - The number of orthologous genes in group.
Paralogs - The number of paralogrous genes in the group
Chromosome Genes - The number of genes residing on chromosomal contigs in the group. This stat only works if a valid chromosome identifier. Consult the demo dataset for an example of this functioning correctly.
Plasmid Genes - The number of genes residing on plasmid contigs in the group. This stat only works if a valid plasmid identifier. Consult the demo dataset for an example of this functioning correctly.
Fragment Genes - The number of genes residing on fragment contigs in the group. This stat only works if a valid fragment identifier. Consult the demo dataset for an example of this functioning correctly.
Protein Products - All the protein products of the genes in the group, separated by the / character. The protein product is parsed from .gff files using the 'product=' tag if present. In an ideal world each gene group should only contain one protein product, and differing protein products could be a sign of a badly constructed group. Consult the demo dataset for an example of this functioning correctly.
Synteny Score SIMPLE - A number between 0 and 40 representing the average SIMPLE synteny score of the group. Consult the manual for details on how this is  calciulated.
Synteny Score SOPHISTICATED - A number between 0 and 40 representing the SOPHISTICATED score of the group. Consult the manual for details on how this is calculated.


--disambiguategroups
Generates file disambiguated_gene_groups.csv with gene groups devoid of paralogs. Consult the manual for details on the disambiguation process.

--generatefnagroups
Generate gene group .fna files which define the sequence of each member of the gene group.

--generatestraincharts
Generates the data files needed for rendering strain charts using the GenerateCharts.R script. Consult the manual for information on what data these charts depict.

--generatesyntenycharts
Generate the data files needed for rendering group synteny charts using the GenerateSyntenyMaps.R script. Consult the manual for information on what data these charts depict.

--presenceabsencematrix
Generage the file presence_absence_matrix.csv which contains a presence/absence matrix based on gene groups. The ; delimited file represents which strains are present "1" or absent "0" in each gene group.

--gapitpresenceabsencematrix
Generage the file presence_absence_gapit.csv which is a GAPIT formatted presence/absence matrix. This file can be directly loaded and passed to GAPIT for use in GWAS analysis of the bacterial strains.

--generelationmatrix
Generate the file gene_relation_matrix.csv which contains a gene relation matrix based on presence/absence of strains in gene groups. This file is needed for rendering a gene relation heatmap using the GenerateHeatmap.R script. Consult the manual for information on how the matrix is calculated.

--chromosomeidentifier=pattern
Sets the character pattern that identifies a chromosomal contig if it is found to be part of its ID. This parameter is needed for contig classification to work. Consult the demo dataset for an example of how this could work.

--plasmididentifier=pattern
Sets the character pattern that identifies a plasmid contig if it is found to be part of its ID. This parameter is needed for contig classification to work. Consult the demo dataset for an example of how this could work.

--fragmentidentifier=pattern
Sets the character pattern that identifies a fragment contig if it is found to be part of its ID. Two number digit characters are assumed to exist right after this pattern in any matched contig ID, which identify the plasmid type, i.e. Rh01. This parameter is needed for contig classification to work. Consult the demo dataset for an example of how this could work.

--syntenizegenepairs=file
Sets the file specifying specific gene pairs to be syntenized into the gene_pairs_synteny.csv output file. Consult the file GenePairs.csv in the demo dataset for an example of formatting.

--genegrouphighlightcolours=file
Sets the file specifying highlight colours for gene group in rendered strain charts. Each ; delimited line defines two items, the first being a gene group ID, and the second a valid R colour said gene group should be highlighted with on rendered strain charts. Consult the file GeneGroupHighlightColours.csv in the demo dataset for an example of formatting.

--classifyfragments
Generate file classified_fragments.csv with fragment classifications based on synteny and gene group information. Below is an explanation of each column in the ; delimited file:
Strain - The ID of the strain this contig belongs to.
Contig - The ID of the contig.
Genes - The number of coding genes on this contig.
Chromosome - A number between 0 and 1 describing the fraction of chromosomal genes in the gene groups of the genes on this contig.
Plasmid - A number between 0 and 1 describing the fraction of plasmid genes in the gene groups of the genes on this contig.
Chromosomal Synteny - A number between 0 and 40 describing the average synteny between chromosomal genes in the gene groups of each gene on this contig.
Plasmid Synteny - A number between 0 and 40 describing the average synteny between plasmid genes in the gene groups of each gene on this contig.
Coverage - A number between -1 and 1 calculated as "chromosome - plasmid". Consult the manual for an explanation of this parameter.
Syneny - A number between -1 and 1 calculated by "(Chromosomal Synteny / 40) - (Plasmid Synteny / 40)". Consult the manual for an explanation of this parameter.
Magnitude - A number between -sqrt(2) and sqrt(2) calculated as +/- sqrt(Coverage^2 + Synteny^2)). Consult the manual for an explanation of this parameter.
Confidence - The confidence attached to the contig classification. This can be IDEAL / HIGH / MEDIUM / LOW / NA .  
Classification - The classification of this contig, which can either be Chromosome, the plasmid identifier followed by two digit type or Ambiguous. Consult the manual for an explanation of this parameter.
Metadata - Extra information on regarding the plasmid classification calculations. Consult the manual for an explanation of this parameter.
